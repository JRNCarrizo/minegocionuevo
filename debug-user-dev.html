<!DOCTYPE html>
<html>
<head>
    <title>Debug Usuario Desarrollo</title>
</head>
<body>
    <h1>Debug Usuario Desarrollo</h1>
    <div id="result"></div>
    
    <script>
        async function debugUser() {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            console.log('üîç Token actual:', token);
            console.log('üîç Usuario actual:', user);
            
            if (token) {
                // Decodificar JWT
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                
                const payload = JSON.parse(jsonPayload);
                console.log('üîç JWT Payload:', payload);
                
                document.getElementById('result').innerHTML = `
                    <h3>Informaci√≥n del Usuario:</h3>
                    <p><strong>Email:</strong> ${user.email || 'No disponible'}</p>
                    <p><strong>Rol:</strong> ${user.rol || 'No disponible'}</p>
                    <p><strong>Empresa ID (localStorage):</strong> ${user.empresaId || 'No disponible'}</p>
                    <p><strong>Empresa ID (JWT):</strong> ${payload.empresaId || 'No disponible'}</p>
                    <p><strong>Usuario ID (JWT):</strong> ${payload.userId || 'No disponible'}</p>
                    <p><strong>Email (JWT):</strong> ${payload.sub || 'No disponible'}</p>
                    
                    <h3>Prueba de Endpoint:</h3>
                    <button onclick="testEndpoint()">Probar /mi-suscripcion</button>
                    <div id="endpoint-result"></div>
                `;
            } else {
                document.getElementById('result').innerHTML = '<p>No hay token - usuario no logueado</p>';
            }
        }
        
        async function testEndpoint() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch('http://localhost:8080/api/super-admin/suscripciones/mi-suscripcion', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.text();
                document.getElementById('endpoint-result').innerHTML = `
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Respuesta:</strong> ${result}</p>
                `;
                console.log('üîç Respuesta completa:', response);
                console.log('üîç Datos:', result);
            } catch (error) {
                document.getElementById('endpoint-result').innerHTML = `
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
                console.error('üîç Error:', error);
            }
        }
        
        // Ejecutar al cargar
        debugUser();
    </script>
</body>
</html>
